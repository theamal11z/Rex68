# Architecture Overview

## Overview

This application is a full-stack web application called "Rex" that serves as a virtual representation of "Mohsin's inner voice." It consists of a React frontend with a terminal-like interface and an Express.js backend with a PostgreSQL database using Drizzle ORM. The application uses a chat-like interface where users can interact with "Rex," which responds using the Gemini AI API.

The system follows a client-server architecture with a clear separation between frontend and backend components. It uses modern web technologies like React, TypeScript, and Tailwind CSS for the frontend and Express.js for the backend server.

## System Architecture

The system consists of three main layers:

1. **Client Layer**: React application with UI components using shadcn/ui, styled with Tailwind CSS
2. **Server Layer**: Express.js backend with API endpoints for message handling, settings management, etc.
3. **Data Layer**: PostgreSQL database accessed via Drizzle ORM with defined schemas

### Directory Structure

```
├── client/                 # Frontend React application
│   ├── index.html          # HTML entry point
│   └── src/                # React application source code
│       ├── components/     # React components including UI library
│       ├── hooks/          # Custom React hooks
│       ├── lib/            # Utility functions and API clients
│       ├── pages/          # Page components
│       └── types/          # TypeScript type definitions
├── server/                 # Backend Express.js server
│   ├── index.ts            # Server entry point
│   ├── routes.ts           # API route definitions
│   ├── storage.ts          # Data storage interface
│   └── vite.ts             # Vite development server configuration
├── shared/                 # Shared code between client and server
│   └── schema.ts           # Database schema definitions using Drizzle ORM
└── migrations/             # Database migration files (generated by Drizzle)
```

## Key Components

### Frontend

1. **Terminal Interface**: The main UI component that mimics a terminal interface for user interactions with Rex.
2. **Admin Panel**: A protected interface for managing the system's configuration and content.
3. **UI Components**: Utilizes shadcn/ui component library, which is built on Radix UI primitives.
4. **React Query**: Used for data fetching, caching, and state management.
5. **Wouter**: Lightweight routing library for page navigation.
6. **Framer Motion**: Animation library for UI transitions.

### Backend

1. **Express Server**: Handles HTTP requests and serves the frontend in production.
2. **API Routes**: RESTful endpoints for messages, settings, users, and content.
3. **Storage Interface**: Abstract interface for data persistence with implementations for database operations.
4. **Authentication**: Simple authentication mechanism for the admin panel.

### Database

The database schema consists of several key tables:

1. **users**: Stores user information with authentication credentials.
2. **messages**: Stores conversation history between users and Rex.
3. **settings**: Stores system configuration including API keys and behavior guidelines.
4. **contents**: Stores content like microblog posts and reflections.
5. **memories**: Stores context information for conversational memory.

## Data Flow

1. **User Interaction**:
   - User sends a message via the terminal interface
   - Frontend sends the message to the backend API
   - Message is stored in the database
   - Backend integrates with Gemini API to generate a response
   - Response is stored in the database and sent back to the frontend
   - Frontend displays the response with a typing animation

2. **Admin Workflow**:
   - Admin authenticates through the admin panel
   - Admin can view and update settings, content, and behavioral guidelines
   - Changes are persisted to the database

## External Dependencies

### Frontend Dependencies
- React for UI rendering
- shadcn/ui and Radix UI for component primitives
- Tailwind CSS for styling
- React Query for data fetching
- Wouter for routing
- Framer Motion for animations

### Backend Dependencies
- Express.js for the HTTP server
- Drizzle ORM for database operations
- Neon Database (PostgreSQL) for data storage
- Zod for schema validation

### External Services
- Google Gemini API for AI text generation

## Authentication and Security

The application implements a simple authentication mechanism for the admin panel. The main user-facing interface does not require authentication, but each user session is tracked with a unique identifier stored in localStorage.

API keys for external services like Gemini are stored in the database settings table rather than being hardcoded in the application.

## Deployment Strategy

The application is designed to be deployed on Replit, as evidenced by the `.replit` configuration file. The deployment process includes:

1. Building the frontend with Vite
2. Bundling the server code with esbuild
3. Running the bundled server which serves the static frontend files

The application is configured for deployment on Replit's autoscaling infrastructure, with the server listening on port 5000 internally and exposed on port 80 externally.

### Development Workflow

During development:
- `npm run dev` starts both the backend server and the Vite development server
- Changes to frontend code are hot-reloaded
- Database schema changes can be pushed using `npm run db:push`

## Architectural Decisions

### Choice of Drizzle ORM
Drizzle was chosen as the ORM for its type safety with TypeScript and its lightweight approach compared to alternatives like Prisma. It provides a schema definition that can be shared between backend and frontend code for consistent type definitions.

### Use of shadcn/ui
The application uses shadcn/ui, which provides unstyled, accessible components built on Radix UI primitives. This approach allows for highly customizable UI components while maintaining accessibility standards. The terminal-themed design is implemented using Tailwind CSS utilities.

### API Design
The backend exposes a RESTful API that handles basic CRUD operations for messages, settings, and content. The API is designed to be simple and focused on the core functionality needed by the application.

### Storage Abstraction
The application implements a storage interface that abstracts database operations, which allows for easier testing and potentially switching between different storage implementations (e.g., in-memory storage for testing, PostgreSQL for production).

### Integration with Gemini API
The application integrates with Google's Gemini API for AI-generated responses, allowing Rex to provide human-like conversation. The integration is designed to be configurable through the admin panel, where the API key and behavioral guidelines can be updated.